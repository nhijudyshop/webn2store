<!doctype html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>C√†i ƒë·∫∑t - FB Manager</title>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- CSS -->
    <!-- Shared Common CSS -->
    <link rel="stylesheet" href="/shared/styles/common.css" />
    
    <!-- Page-specific CSS -->
    <link rel="stylesheet" href="/facebookcomment/styles.css" />
</head>
<body>
    <!-- Sidebar s·∫Ω t·ª± ƒë·ªông load b·ªüi sidebar.js -->

    <div class="container settings-container">
        <div class="header">
            <h1>‚öôÔ∏è C√†i ƒë·∫∑t</h1>
            <div class="tabs-nav">
                <button class="tab-button" data-tab="printers">
                    <i data-lucide="printer"></i> M√°y in
                </button>
                <button class="tab-button" data-tab="template">
                    <i data-lucide="file-text"></i> Template In
                </button>
                <button class="tab-button active" data-tab="general">
                    <i data-lucide="settings-2"></i> Chung
                </button>
            </div>
        </div>

        <!-- Printers Tab -->
        <div class="tab-content" id="printers">
            <!-- Server Status -->
            <div class="content-section">
                <div class="flex items-center justify-between mb-4">
                    <h2>üåê Tr·∫°ng th√°i Server</h2>
                    <div id="serverStatus" class="server-status">
                        <span class="status-dot"></span>
                        <span class="status-text">ƒêang ki·ªÉm tra...</span>
                    </div>
                </div>
                <div class="server-info">
                    <p><strong>Bridge URL:</strong> <code id="bridgeUrl">http://localhost:3001</code></p>
                    <p><strong>Ch·∫ø ƒë·ªô:</strong> Full Width & Bold (80mm)</p>
                    <p class="text-sm text-gray-600 mt-2">
                        üí° ƒê·∫£m b·∫£o server ƒëang ch·∫°y: <code>node server.js</code>
                    </p>
                </div>
            </div>

            <!-- Add Printer Form -->
            <div class="content-section">
                <h2>‚ûï Th√™m m√°y in m·ªõi</h2>
                <form id="addPrinterForm" class="printer-form">
                    <div class="form-group">
                        <label for="printerName">T√™n m√°y in:</label>
                        <input type="text" id="printerName" placeholder="V√≠ d·ª•: M√°y in kho A" required />
                    </div>
                    <div class="form-group">
                        <label for="printerIp">IP Address:</label>
                        <input type="text" id="printerIp" placeholder="192.168.1.100" required />
                    </div>
                    <div class="form-group">
                        <label for="printerPort">Port:</label>
                        <input type="number" id="printerPort" placeholder="9100" value="9100" required />
                    </div>
                    <div class="form-group">
                        <label for="printerBridge">Bridge URL:</label>
                        <input type="text" id="printerBridge" placeholder="http://localhost:3001" value="http://localhost:3001" required />
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i data-lucide="plus"></i> Th√™m m√°y in
                    </button>
                </form>
            </div>

            <!-- Printer List -->
            <div class="content-section">
                <h2>üñ®Ô∏è Danh s√°ch m√°y in</h2>
                <div id="printerList" class="printer-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">üñ®Ô∏è</div>
                        <p>Ch∆∞a c√≥ m√°y in n√†o ƒë∆∞·ª£c th√™m.</p>
                    </div>
                </div>
            </div>

            <!-- Test Print Section -->
            <div class="content-section">
                <h2>üß™ Test In Bill</h2>
                <div class="test-print-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="testSessionIndex">Session Index:</label>
                            <input type="text" id="testSessionIndex" value="001" />
                        </div>
                        <div class="form-group">
                            <label for="testPhone">S·ªë ƒëi·ªán tho·∫°i:</label>
                            <input type="text" id="testPhone" value="0901234567" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="testCustomerName">T√™n kh√°ch h√†ng:</label>
                            <input type="text" id="testCustomerName" value="Nguy·ªÖn VƒÉn A" />
                        </div>
                        <div class="form-group">
                            <label for="testProductCode">M√£ s·∫£n ph·∫©m:</label>
                            <input type="text" id="testProductCode" value="SP001" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="testProductName">T√™n s·∫£n ph·∫©m:</label>
                        <input type="text" id="testProductName" value="C√† ph√™ s·ªØa ƒë√°" />
                    </div>
                    <div class="form-group">
                        <label for="testComment">Ghi ch√∫:</label>
                        <input type="text" id="testComment" value="√çt ƒë∆∞·ªùng" />
                    </div>
                    <button onclick="testPrint()" id="testPrintBtn" class="btn btn-primary btn-large">
                        <i data-lucide="printer"></i> Test In Bill
                    </button>
                </div>
            </div>
        </div>

        <!-- Template Tab -->
        <div class="tab-content" id="template">
            <!-- Format Settings -->
            <div class="content-section">
                <h2>‚öôÔ∏è T√πy ch·ªânh Format</h2>
                <div class="template-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="templateWidth">
                                <i data-lucide="maximize-2"></i> Width (px)
                            </label>
                            <select id="templateWidth">
                                <option value="1024">1024px (72mm)</option>
                                <option value="1152" selected>1152px (80mm)</option>
                                <option value="custom">Custom...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="templateHeight">
                                <i data-lucide="move-vertical"></i> Height
                            </label>
                            <select id="templateHeight">
                                <option value="auto" selected>Auto</option>
                                <option value="550">550</option>
                                <option value="600">600</option>
                                <option value="custom">Custom...</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="templateThreshold">
                                <i data-lucide="circle"></i> Threshold
                            </label>
                            <select id="templateThreshold">
                                <option value="85">85</option>
                                <option value="90">90</option>
                                <option value="95" selected>95 - ƒê·∫≠m ‚≠ê</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="templateScale">
                                <i data-lucide="zoom-in"></i> Scale
                            </label>
                            <select id="templateScale">
                                <option value="1">1x</option>
                                <option value="2" selected>2x ‚≠ê</option>
                                <option value="3">3x</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Font Sizes -->
            <div class="content-section">
                <h2>üî§ Font Sizes</h2>
                <div class="template-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fontSession">Session (#001)</label>
                            <input type="number" id="fontSession" value="72" min="20" max="120" />
                        </div>
                        <div class="form-group">
                            <label for="fontPhone">Phone</label>
                            <input type="number" id="fontPhone" value="52" min="10" max="80" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fontCustomer">Customer Name</label>
                            <input type="number" id="fontCustomer" value="52" min="10" max="80" />
                        </div>
                        <div class="form-group">
                            <label for="fontProduct">Product</label>
                            <input type="number" id="fontProduct" value="36" min="10" max="80" />
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="fontComment">Comment</label>
                            <input type="number" id="fontComment" value="32" min="10" max="80" />
                        </div>
                        <div class="form-group">
                            <label for="fontTime">Time</label>
                            <input type="number" id="fontTime" value="28" min="10" max="60" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alignment -->
            <div class="content-section">
                <h2>üìç CƒÉn ch·ªânh</h2>
                <div class="alignment-buttons">
                    <button class="align-btn" data-align="left" onclick="setAlignment('left')">
                        <i data-lucide="align-left"></i> Tr√°i
                    </button>
                    <button class="align-btn active" data-align="center" onclick="setAlignment('center')">
                        <i data-lucide="align-center"></i> Gi·ªØa
                    </button>
                    <button class="align-btn" data-align="right" onclick="setAlignment('right')">
                        <i data-lucide="align-right"></i> Ph·∫£i
                    </button>
                </div>
            </div>

            <!-- Font Style -->
            <div class="content-section">
                <h2>‚úèÔ∏è Ki·ªÉu ch·ªØ</h2>
                <div class="font-style-options">
                    <label class="checkbox-label">
                        <input type="checkbox" id="fontBold" checked />
                        <span>In ƒë·∫≠m (Bold)</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="fontItalic" />
                        <span>In nghi√™ng (Italic)</span>
                    </label>
                </div>
            </div>

            <!-- Spacing -->
            <div class="content-section">
                <h2>üìè Kho·∫£ng c√°ch</h2>
                <div class="template-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="templatePadding">Padding (px)</label>
                            <input type="number" id="templatePadding" value="20" min="0" max="50" />
                        </div>
                        <div class="form-group">
                            <label for="templateLineSpacing">Line Spacing</label>
                            <input type="number" id="templateLineSpacing" value="12" min="0" max="30" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- Save & Preview -->
            <div class="content-section">
                <div class="action-buttons">
                    <button onclick="saveTemplateSettings()" class="btn btn-primary btn-large">
                        <i data-lucide="save"></i> L∆∞u c√†i ƒë·∫∑t
                    </button>
                    <button onclick="resetTemplateSettings()" class="btn btn-secondary btn-large">
                        <i data-lucide="rotate-ccw"></i> ƒê·∫∑t l·∫°i m·∫∑c ƒë·ªãnh
                    </button>
                    <button onclick="previewTemplate()" class="btn btn-info btn-large">
                        <i data-lucide="eye"></i> Xem tr∆∞·ªõc
                    </button>
                </div>
            </div>
        </div>

        <!-- General Tab -->
        <div class="tab-content active" id="general">
            <div class="content-section">
                <h2>üîë Bearer Token</h2>
                <div class="form-group">
                    <label for="bearerTokenSettings">
                        <i data-lucide="key"></i>
                        Bearer Token (b·∫Øt bu·ªôc):
                    </label>
                    <div style="display: flex; gap: 12px; align-items: flex-end;">
                        <input
                            type="password"
                            id="bearerTokenSettings"
                            placeholder="Nh·∫≠p Bearer Token t·ª´ TPOS..."
                            style="flex: 1"
                        />
                        <button
                            type="button"
                            class="btn btn-primary"
                            onclick="toggleTokenVisibilitySettings()"
                            style="padding: 12px 20px"
                        >
                            <i data-lucide="eye" id="eyeIconSettings"></i>
                        </button>
                        <button
                            type="button"
                            class="btn btn-success"
                            onclick="saveTokenSettings()"
                            style="padding: 12px 20px"
                        >
                            <i data-lucide="save"></i>
                            L∆∞u Token
                        </button>
                    </div>
                    <small style="color: #64748b; margin-top: 8px; display: block;">
                        Token s·∫Ω ƒë∆∞·ª£c l∆∞u trong tr√¨nh duy·ªát.
                    </small>
                </div>
            </div>
            
            <!-- New TPOS Account Section -->
            <div class="content-section">
                <h2>üë§ T√†i kho·∫£n TPOS</h2>
                <div class="form-group">
                    <label for="tposUsername"><i data-lucide="user"></i> T√™n ƒëƒÉng nh·∫≠p:</label>
                    <input type="text" id="tposUsername" placeholder="Nh·∫≠p username TPOS">
                </div>
                <div class="form-group" style="margin-top: 12px;">
                    <label for="tposPassword"><i data-lucide="lock"></i> M·∫≠t kh·∫©u:</label>
                    <input type="password" id="tposPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u TPOS">
                </div>
                <button onclick="loginAndSaveToken()" id="loginTposBtn" class="btn btn-primary" style="margin-top: 16px; width: 100%;">
                    <i data-lucide="log-in"></i> ƒêƒÉng nh·∫≠p & L·∫•y Token
                </button>
                <small style="color: #64748b; margin-top: 8px; display: block;">
                    T√†i kho·∫£n s·∫Ω ƒë∆∞·ª£c l∆∞u tr√™n server ƒë·ªÉ t·ª± ƒë·ªông l·∫•y token.
                </small>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <!-- Shared Sidebar JS -->
    <script src="/shared/sidebar/sidebar.js"></script>
    
    <!-- Shared API Service (for TPOS) -->
    <script type="module" src="/shared/api/tpos-api.js"></script>
    
    <!-- Page JS -->
    <script type="module" src="/facebookcomment/app.js"></script>
</body>
</html>