<!doctype html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Quản Lý Đặt Hàng - Order Management</title>

        <!-- Lucide Icons -->
        <script src="https://unpkg.com/lucide@latest"></script>

        <!-- Shared Common CSS -->
        <link rel="stylesheet" href="/shared/styles/common.css" />
        
        <!-- Page-specific CSS -->
        <link rel="stylesheet" href="/pages/orders/orders.css" />
    </head>
    <body>
        <!-- Sidebar sẽ tự động load bởi sidebar.js -->

        <div class="container">
            <!-- Header -->
            <div class="orders-header">
                <div class="header-content">
                    <h1>Quản lý đặt hàng</h1>
                    <p>Theo dõi và quản lý đơn đặt hàng với các nhà cung cấp</p>
                </div>
                <button class="btn-create-order" id="createOrderBtn">
                    <i data-lucide="plus"></i>
                    Tạo đơn đặt hàng
                </button>
            </div>

            <div class="main-content-area">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i data-lucide="file-text"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalOrders">47</div>
                            <div class="stat-label">Tổng đơn hàng</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i data-lucide="dollar-sign"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalValue">
                                143.307.000 ₫
                            </div>
                            <div class="stat-label">Tổng giá trị</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i data-lucide="clock"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="todayOrders">9</div>
                            <div class="stat-label">Đơn hôm nay</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i data-lucide="trending-up"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="todayValue">
                                48.132.000 ₫
                            </div>
                            <div class="stat-label">Giá trị hôm nay</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i data-lucide="refresh-cw"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="syncStatus">0/328</div>
                            <div class="stat-label">Đồng bộ TPOS</div>
                            <div class="stat-sublabel">0.0% đã upload</div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Tabs -->
                <div class="nav-tabs">
                    <button class="tab-btn active" data-tab="orders">
                        Đơn hàng
                    </button>
                    <button class="tab-btn" data-tab="drafts">
                        Nháp <span class="badge">0</span>
                    </button>
                    <button class="tab-btn" data-tab="products">
                        <i data-lucide="package"></i>
                        Sản phẩm đã đặt
                    </button>
                </div>

                <!-- Orders Section -->
                <div class="orders-section">
                    <div class="section-header">
                        <div class="section-title">
                            <h2>Danh sách đơn đặt hàng</h2>
                            <p>
                                Xem và quản lý tất cả đơn đặt hàng với nhà cung
                                cấp
                            </p>
                        </div>
                        <div class="export-buttons">
                            <button class="btn-export" id="exportPurchaseBtn">
                                <i data-lucide="shopping-cart"></i>
                                Xuất Excel mua hàng
                            </button>
                            <button class="btn-export" id="exportProductsBtn">
                                <i data-lucide="download"></i>
                                Xuất Excel Thêm SP
                            </button>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="filters-section">
                        <div class="date-filters">
                            <div class="date-input">
                                <label>Từ ngày:</label>
                                <div class="date-picker">
                                    <i data-lucide="calendar"></i>
                                    <button id="selectDateFromBtn">
                                        Chọn ngày
                                    </button>
                                </div>
                            </div>
                            <div class="date-input">
                                <label>Đến ngày:</label>
                                <div class="date-picker">
                                    <i data-lucide="calendar"></i>
                                    <button id="selectDateToBtn">
                                        Chọn ngày
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="filter-controls">
                            <div class="quick-filter">
                                <label>Lọc nhanh:</label>
                                <select id="quickFilter">
                                    <option value="all">Tất cả</option>
                                    <option value="today">Hôm nay</option>
                                    <option value="week">Tuần này</option>
                                    <option value="month">Tháng này</option>
                                </select>
                            </div>
                            <div class="search-box">
                                <i data-lucide="search"></i>
                                <input
                                    type="text"
                                    placeholder="Tìm nhà cung cấp, tên/mã sản phẩm, ngày (dd/mm)..."
                                    id="searchInput"
                                />
                            </div>
                            <div class="status-filter">
                                <i data-lucide="filter"></i>
                                <select id="statusFilter">
                                    <option value="all">Tất cả trạng thái</option>
                                    <option value="waiting">Chờ Hàng</option>
                                    <option value="delivered">Đã giao</option>
                                    <option value="cancelled">Đã hủy</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Orders Table -->
                    <div class="orders-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ngày đặt</th>
                                    <th>Nhà cung cấp</th>
                                    <th>Hóa đơn (VND)</th>
                                    <th>Tên sản phẩm</th>
                                    <th>Mã sản phẩm</th>
                                    <th>Biến thể</th>
                                    <th>Số lượng</th>
                                    <th>Giá mua (VND)</th>
                                    <th>Giá bán (VND)</th>
                                    <th>Ghi chú</th>
                                    <th>Trạng thái</th>
                                    <th>Chỉnh sửa ĐH</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <!-- Sample data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Order Modal -->
        <div id="createOrderModal" class="modal-overlay" style="display: none;">
            <datalist id="productSuggestionsModal"></datalist>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Tạo đơn đặt hàng mới</h2>
                    <div class="header-actions">
                        <button class="btn-clear" id="clearOrderFormBtn">
                            <i data-lucide="rotate-cw"></i> Clear
                        </button>
                        <button class="btn-close" id="closeCreateOrderModalBtnHeader">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="order-info-grid">
                        <div class="form-group" style="grid-column: span 1;">
                            <label>Nhà cung cấp *</label>
                            <input type="text" placeholder="Nhập tên nhà cung cấp">
                        </div>
                        <div class="form-group">
                            <label>Ngày đặt hàng</label>
                            <input type="date" id="orderDateInput">
                        </div>
                        <div class="form-group">
                            <label>Số tiền hóa đơn (VND)</label>
                            <input type="number" placeholder="Nhập số tiền VND">
                        </div>
                        <div class="form-group" style="grid-row: span 2;">
                            <label>Ảnh hóa đơn</label>
                            <div class="image-dropzone">
                                <i data-lucide="image"></i>
                                <span>Ctrl+V</span>
                            </div>
                        </div>
                    </div>

                    <div class="product-list-section">
                        <div class="product-list-header">
                            <h3>Danh sách sản phẩm</h3>
                        </div>
                        <div class="product-table-wrapper">
                            <table>
                                <thead>
                                    <tr>
                                        <th>STT</th>
                                        <th>Mã sản phẩm</th>
                                        <th>Tên sản phẩm</th>
                                        <th>SL</th>
                                        <th>Giá mua (VND)</th>
                                        <th>Giá bán (VND)</th>
                                        <th>Thành tiền (VND)</th>
                                        <th>Hình ảnh sản phẩm</th>
                                        <th>Hình ảnh Giá mua</th>
                                        <th>Biến thể</th>
                                        <th>Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody id="modalProductList">
                                    <!-- Product rows will be added here by JS -->
                                </tbody>
                            </table>
                        </div>
                        <div class="product-table-footer">
                            <button class="btn-add-product" id="addProductRowBtn">
                                <i data-lucide="plus"></i> Thêm sản phẩm
                            </button>
                            <div class="total-quantity">
                                <strong>Tổng số lượng:</strong> <span id="modalTotalQuantity">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 24px;">
                        <label>Ghi chú</label>
                        <textarea placeholder="Ghi chú thêm cho đơn hàng..." rows="3"></textarea>
                    </div>

                    <div class="order-summary">
                        <div class="summary-row">
                            <label>Tổng tiền:</label>
                            <span class="value" id="modalSubtotal">0 ₫</span>
                        </div>
                        <div class="summary-row">
                            <label>Giảm giá:</label>
                            <input type="number" value="0" class="form-control" oninput="window.updateTotals()">
                        </div>
                        <div class="summary-row">
                            <label><i data-lucide="truck"></i> Thêm tiền ship</label>
                            <input type="number" value="0" class="form-control" oninput="window.updateTotals()">
                        </div>
                        <div class="summary-row total">
                            <label>Thành tiền:</label>
                            <span class="value" id="modalTotal">0 ₫</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" id="closeCreateOrderModalBtnFooter">Hủy</button>
                    <button class="btn-tertiary">Lưu nháp</button>
                    <button class="btn-primary">Tạo đơn hàng</button>
                </div>
            </div>
        </div>

        <!-- JavaScript -->
        <!-- Shared Sidebar JS -->
        <script src="/shared/sidebar/sidebar.js"></script>
        
        <!-- Page JS -->
        <script type="module" src="/pages/orders/orders.js"></script>
    </body>
</html>